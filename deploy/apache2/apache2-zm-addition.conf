# Zoom議事録自動配布システム用 Apache2設定追加部分
# 既存のtools.cross-astem.jp.ssl.confに追加する設定

###ここからZoom議事録システム追加###

# Zoom議事録システム用ProxyPass設定（個別タイムアウト指定）

# Zoom Webhook（5分・軽量処理）
ProxyPass /zm/api/webhooks/zoom http://localhost:3020/api/webhooks/zoom timeout=300
ProxyPassReverse /zm/api/webhooks/zoom http://localhost:3020/api/webhooks/zoom

# 音声アップロード（10分・重い処理）
ProxyPass /zm/api/upload/audio http://localhost:3020/api/upload/audio timeout=600
ProxyPassReverse /zm/api/upload/audio http://localhost:3020/api/upload/audio

# デバッグAPI（統合フローテスト用・5分）
ProxyPass /zm/api/debug/test-full-flow http://localhost:3020/api/debug/test-full-flow timeout=300
ProxyPassReverse /zm/api/debug/test-full-flow http://localhost:3020/api/debug/test-full-flow

# その他のAPI（1分・一般的な処理）
ProxyPass /zm/api/ http://localhost:3020/api/ timeout=60
ProxyPassReverse /zm/api/ http://localhost:3020/api/

# フロントエンド（Next.js）
ProxyPass /zm/ http://localhost:3021/zm/
ProxyPassReverse /zm/ http://localhost:3021/zm/

# Location設定（リクエストサイズ制限・セキュリティヘッダー）

# Zoom Webhook専用設定
<Location "/zm/api/webhooks/zoom">
    LimitRequestBody 10485760
    Header always set Access-Control-Allow-Origin "https://tools.cross-astem.jp"
    Header always set Access-Control-Allow-Methods "POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Zoom-Webhook-Signature"
</Location>

# 音声アップロード専用設定（大きなファイル対応）
<Location "/zm/api/upload/audio">
    LimitRequestBody 104857600
    Header always set Access-Control-Allow-Origin "https://tools.cross-astem.jp"
    Header always set Access-Control-Allow-Methods "POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
</Location>

# デバッグAPI設定（開発・テスト用）
<Location "/zm/api/debug/">
    LimitRequestBody 10485760
    Header always set Access-Control-Allow-Origin "https://tools.cross-astem.jp"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
</Location>

# 一般的なAPI設定
<Location "/zm/api/">
    Header always set Access-Control-Allow-Origin "https://tools.cross-astem.jp"
    Header always set Access-Control-Allow-Credentials "true"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
</Location>

# フロントエンド設定
<Location "/zm/">
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</Location>

###ここまでZoom議事録システム追加###

# 設定説明:
# - 既存の設定を一切変更せず、/zm/ パスのみ追加
# - Zoom Webhook: 300秒（軽量なJSON処理）
# - 音声アップロード: 600秒（大容量ファイル + AI処理）
# - デバッグAPI: 300秒（統合フローテスト用）
# - その他API: 60秒（一般的な処理）
# - 他のサービス（/wf/, /ss/, /mass/, /mail/, /mnt/）には影響なし